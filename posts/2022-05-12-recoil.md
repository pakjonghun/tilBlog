---
date: 2022-05-12
category: recoil
---

## 겪은 어려움

- 레코일에서 loadable 객체로 반환하게 하는 방법을 사용했는데 console.log가 안먹히고
  - inputArgs[0].match is not a function 이라는 오류가 떠서 당황했다.
  - console.dir 로 찍으니 잘찍히는 걸로 봐서 로더블 값은 객체인데
  - console.log 를 실행하는데 필요한 match 가 proto_type 에 안들어있는 객체라서
  - 오류가 나는 것으로 생각된다.(레코일 에서 로더블 객체 만들때 일부로 지웠나?...)
- 레코일은 셀렉터를 잘 이용해서 하며 캐쉬를 이해 해야 스테이트를 줄이면서 신나게 쓸 수 있다.
  - 무한스크롤 을 할때 페이지 아톰을 만들고
  - 페이지를 변경하면 서 그 페이지를 구독하는 셀렉터가
  - 자동으로 통신 후 값을 반환하게 했는데
  - 처음에는 이 값을 기존 데이터 값과 합치면서 작업하려 했다. 참 멍청했다고 생각한다...
  - 왜나하면 이렇게 하면 불필한랜더링이 더 일어나고 스테이트 관리도 힘들어 지기 때문이다.
  - 통신은 다 했고 캐슁도 되 있고, 어딘가 저장 되 있는데 그걸 굳이 또 가져와서 다른 스테이트에 또 setState 하고 , setState 하면 또 랜더링 되고 등등..
  - 이걸 한번에 다 처리하는 셀렉터를 만들어서 처리하면 되는데 참 바보 같았다고 생각했다.
  - 즉 셀렉터가 페이지를 구독하고 있던 말던 혹은 familySelector 로 인자를 받던 말던 간에
  - 통신을 페이지별로 순회시키면서 하면 알아서 캐슁 되 있는 데이터를 다 갖고 온다.
  - 대신 병렬 처리를 할지 직렬 처리를 할지 에러가 날때 어떻게 해줄지를 정해줘야 하는데
  - 데이터가 원시값이고 빠른 랜더링이 필요할 경우 noWait
  - 데이터가 객체인데 빠른랜더링이 필요할 경우 waitForNone([...promises])
  - 데이터가 객체지만 전부 다 받은 다음에 랜더링 되야 할 경우 waitForAll([...promises])
  - 데이터가 최소한 1개라도 fulfilled 된 후에 랜더링을 진행하려면 waitForAny([...promises])
  - 등을 사용 해서 처리 해주면 되었다.
- 스냅샷은 디버깅 하거나 useRecoilCallback 때만 언급이 되던데
  - preFetch 기능이라고 해서 한번 써 봤는데 그다지... 왜 쓰는지 아직은 와닿지가 않았다.
  - 이전 스테이트로 돌아가게 하는 기능이 있어서 유용 할 줄 알았는데 쓸 일이 아직은 생각나지 않는다.
- useResetRecoilState 인가? 이 기능은 기존값으로 아톰을 초기화 시키는 훅인데
  - 너무 늦게 알게 된 훅이라 아직 한번도 안써본 훅이다.
  - 하지만 앞으로 많이 사용하게 될 것 같았다.
- useAtomEffect 인가? 이거 useEffect 를 레코일 코드에 넣어서
  - 좀더 복잡한 비동기를 동기로 표현 할수 있게 하는 방법 인 것 같았다.
  - 글쎄 쓸일이 없을 것 같다. 아직은 왜냐하면 실험적인 기능이기 때문이다.
- recoil 을 2두번째로 사용 해봤는데
  - axios 같은 걸 섞어서 써서 조금 후회가 된다.
  - 별다른 라이브러리 없이 혼자 쓰면 좀더 좋은 툴 이 될 것 같다.

## 관심가는 recoil 기능

- 스냅샷 은 아직 잘 이해가 안된다 그래서 계속 보고 있다.
- 저장소에 접근해서 조작하는 얼마 안되는 방법이라고 소개를 해 주던데
- 또 랜더링이 의도적으로 일어나게 하거나 안나게 하거나 할 수 있었는데
- 프리패칭이나 기타 덜 중요한 일을 처리하라고 할때 사용 할 수 있는 것 같았다.
- 무한스크롤 할때 미리 그 다음 커서 값을 받아오게 하면 얼마나 좋을까 생각을 하면서 이 기능을 계속 살펴보고 있다.
- AtomEffect는 아직 제대로 살펴보지 못했다. 셀프 셋 온셋 타겟 노드 등 인자가 있던데
- 꽤 유용 할 것 같고 관심도 많이 갖고 있다.

## 앞으로 계획

- 레코일은 좋은 툴이라고 생각한다.
- 파생된 스테이트 관리 캐슁관리 이 두가지만 눈여겨 보았는데
- 다른 것도 많이 있을 것 같아서 좀더 공식 문서를 뒤지면서 계속 알아볼 생각이다.
- 또 구글링을 해도 예문이 별로 없어서 속상했는데 관련 경험했던 코드를 나라도 블로그나 다른 곳에 많이 올려서
- 공유하고 또 피드백도 많이 받고 싶다.
