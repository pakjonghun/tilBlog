---
date: 2022-04-23
category: til
---

## 오늘 한 일

- 알고리즘 순위검색을 풀었다.
- 그런데 코드 다 지우고 다시 기억나는대로 다시 풀어봤는데 답이 틀려서 내일 좀더 해볼 생각이다.
- RTK doc 를 한번 천천히 다시 예문 따라가면서 이것저것 사용 해봤다.
- RTK Query 를 프로젝트에 하나 하나 적용해 보았다.

## 어려운점

- 서버와 동기화 시키는 방법을 고민했다.
- 기준은 서버 상태에 맞추고,
- 실시간으로 작동하는 것 처럼 하기 위해서 매 마운트 할때나 새로고침 할때 혹은 포커스가 있을때
- 통신을 하게끔 하고 interval 도 적용 할 수도 있을것 같으나.
- 그렇게 할 바엔느 차라리 서버 만들고 socket.io 를 사용하는게 낫지 않겠나 싶어서
- 조금 복잡하지만 서버와 동기화를 위한 기준(유저 상태)을 정해서
- 그 기준을 위한 전용 api 를 만들고(기준을 내려받음)
- 내려받는 과정에서 useEffect 막 돌리고 하는게 아니라(이건 1,2개면 잘 먹히는데 3~4개 고려해야 될게 늘어나면 정말 머리 아파진다)
- RTK 의 queryFn 을 통해서 결과값에 따른 dispatch 를 모두 해 주었다.
- 이렇게 하니 장점은 한 곳에서 한 통신의 결과에 따른 실행 내용을 집중해서 관리 할 수 있어서 좋았고
- 이 결과를 자동으로 캐슁 할 수 있다는게 좋았고
- 또 별도로 재실행 혹은 refetch 이런서 안써도
- 태그 기능을 이용해서 리패칭 하도록 만들면서 RTK 쿼리가 재미가 있다고 느꼈다.
- mutation 보다 query 가 훨씬 기능이 많았는데 사실 설명을 읽어도 무슨말인지 잘 모르겠고...
- 직접 사용 할 일이 곧 생길 것 같은데 그때 다시 봐야겠다고 생각했다.
- 이제야 프로젝트에 맞는 스테이트 관리 툴을 찾은 것 같아서 다행이라고 생각했다.
- 반면 벌써 2주째 1 프로젝트에만 매달려 있어서, 좀더 속도를 내야 겠다고 생각했다.

## 해야 할 일

- 타이머 레코드 작성(이거 그냥 api 에서 받아와서 뿌려주고 끝), 수정할 때 optimastic 으로 변경되도록 만들것
- 레코드 표 thead 를 유저 용과 관리자 용을 합쳐서 관리 해볼 것(기능이 완전똑같은데 타입만 다르므로)
- 약간만 고민해서 타입만 매칭 시키면(키는 포기한다 그냥 string으로 해버리고..)
- 충분히 가능 할 것 같다.
