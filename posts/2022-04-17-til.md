---
date: 2022-04-17
category: til
---

## 오늘 한 일

- 알고리즘 1문제! 대진표 풀었다(단순 수학문제 였다.)
- 인가인증기능을 구현해 쿠키 방법으로 ironSession 라이브러리 이용해서 구현했다.
- 연장선으로 로그인 여부에 따른 리다이렉션 기능도 구현했다.

## 어려운점

- 인가인증 기능 구현 방법을 정하기가 어려웠다.
- 처음에는 기존에 했던 방법처럼 jwt 와 cookie 이용해서 token 을 쿠키에 담아서 주고 받으려고 했다.
- 문제는 serverless 라서 그런지 broswer 에서 쿠키가 나타났다가 사라졌다가 한다는것..
- 알아보니 serverless 에서는 httponly 방식으로 쿠키를 사용한다고 한다?
- 아무리 그래도 요청할때는 header 에 쿠키가 붙어서 나갈텐데...
- 지금도 잘 모르겠다.
- 쿠키가 브라우저에서 안 보이는 문제때문에 미들웨어(베타기능)에서 쿠키를 인식하지 못해서 리다이렉션 기능 구현에 어려움이 있었다.
- 쿠키를 보지 않고 쌩 api 로 다 만들어서 구현 해버릴까 하다가.. 오기가 생겨서 결국 ironsession 을 사용해서 구현했다.
- ironsession 은 공식문서에도 소개 되어 있고, 인강에서도 알려주고 있고, 사용법도 단순해 보여서 사용했는데
- 걸리는점은 1주 다운로드가 1300 정도 밖에 안되서...
- 일반 백엔드면 쿠키 별 신경안쓰고 빨리 만들텐데 이건 몰라서 그런지 몰라도 너무 오래 걸렸다.
- 쿠키는 도대체 왜 미들웨어에서 못 읽어 내는지 그 원인을 찾기에는 미들웨어가 배타 기능이고, 아직 사용하는 사람도 많이 없는 것 같아서 일단 라이브러리 이용해서 구현했다.
- 미들웨어에서 실행되는 것이 브라우저 단에서 실행되는 것으로 인식되던데 httponly 쿠키가 브라우저에서 못 읽히는데 어떻게 미들웨어에는 찾아내 지는지 신기했다... ㅠ ㅠ
- 리다이렉션 시 조건을 찾아내기가 쿠키로 사용하다 보니 어려웠다.
- 1차적으로 쿠키가 있는지 없는지 확인하고 로그인이 필요한 페이지에서는 추가로 쿠키가 올바른 쿠키인지 api 를 통해 확인했다.
- 별도로 쿠키 확인 api 를 만들려다가 미들웨어에 몰아서 확인하는 걸로 합쳤다.
- 페이지 전환할때마다 미들웨어에서 (api 제외)쿠키가 있는지 확인에서 리다이렉션 해준다
- 이렇게 하면 로딩 페이지를 띄울 필요가 없어서 편했다.
- 다만 로그인이 필요한 페이지는 2차로 올바른 쿠키인지 쿠키에 정보가 실제 db에 있는 건지 확인을 했는데
- 이 확인 통신을 할 동안에 페이지가 안보이게 막아놔야 해서 isLoading 시 스피너만 뜨도록 해 놓았다.
- 올바른 쿠키면 그대로 통과! 쿠키가 이상한거면 다시 로그인 페이지로 리다이렉션!
- 미들웨어 사용하다가 결과를 return 해주어야 작동하는데 그걸 모르고 그냥 메서드만 막 쓰다가 안되서 시간을 많이 허비했다 ㅠ ㅠ .

## 해야 할 일

- 메인페이지 (초과근무 시간 저장, 불러오기, 시간목록 띄우기, 시간 관리 ui 최적화) 작성
- 매니저가 보는 기록페이지 api 와 일반 유저가 보는 기록페이지가 서로 다르도록 작성
- 매니저가 보는 기록페이지 검색 과 일반 유저가 보는 기록페이지 검색이 서로 다르도록 고민(일반 유저는 자기것만, 매니저는 싹다)
- 게시판 구현, 댓글 구현
- 매니저 어드민 메인 페이지 구상(이건 아직 안만들었는데 차트 부터 이것 저것 통계 수치 볼 수 있게 만들면 재미있을 것 같다)

- 위 기능 화면 구현시 리덕스가 굳이 필요할까? 필요 없을 거라고 생각한다.
- 굳이 더 추가한다면 contextapi 정도라고 생각한다.
- 채팅기능은 일단 놔두고 다 만들면 배포, 검색 ui 는 블로그에 같이 적용 할 것
