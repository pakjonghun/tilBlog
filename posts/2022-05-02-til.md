---
date: 2022-05-02
category: til
---

## 오늘 한 일

- nextjs 로 만든 프로젝트(serverLess)가 vercel 에 배포했을 시 느린 이유를 검색 해보았다.
- 비슷한 이슈를 겪는 사람이 꽤 있었는지 검색결과가 꽤 나왔고 크게 2가지 의견을 찾을 수 있었다.
  - 1. vercel을 무료로 사용 할 경우 느릴 수 있다.(서버리스로 느릴 경우 db 의 위치와 api 의 위치를 고려하라고 doc에 나와있고, plan 에 위치를 가깝헤 하는 방법이 있다고 적혀있음... 돈내라는 말임.. ㅠ )
  - 2. 리전이 다를 경우 혹은 리전이 같더라도 백 서버위치와 프론트 서버 위치가 다른경우 느릴 수 있다. 같은위치에 두고 쓰면 빨라진다!
- 1번은 내가 예상했던 이유였다.
- 2번은 서버리스 이므로 해당사항이 없었다.(프론트 섭에서 다 해먹는데 뭐 ㅋㅋ)
- 결국 해결방법은 돈내고 빠르게 쓰던가 백엔드 서버를 구성해서 백과 프론트를 같은 ec2 에서 돌리던가 였다.
- 백엔드 서버를 만들기 시작하면 공부 해야 할 것이 많다는 것이 걱정이 되었다.
- 하지만 백엔드를 어처피 알아야 되고, 이전에 조금 공부 해 놓은 것도 있기 때문에 한번 다시 되짚어 볼 겸 고민을 해보았다.
- nodejs 의 탄탄한 백엔드 프레임워크 express !! fantastic 한 nestjs!! 중에 아무래도 가장 마지막까지 계속 만져 보았던 네스트를 한번 봐볼까? 하고 뭐 바뀐게 있나? 확인도 할 겸 nest doc 를 천천히 읽어보았다.
- doc 를 읽어보니 exception filter 부분에 뭐 하나 추가된것 같은게 보이고(이전엔 못봤던 메서드가 1개 있었음)
- validation 에서 class-validator 로 글로벌하게 사용하기 전에 사용자가 커스텀 하는 부분도 보 흥미롭게 읽었고 이전에는 그냥 class-valitor library doc 만 보고 처리했었는데 nest에서도 커스텀이 가능했다. 그것도 개별 매서드 수준에서 가능했다.
- 이전에는 아예 쓰지도 않았던 interceptor 부분도 읽어 보았다.(이건 아마 계속 쓸일 없을 것 같아 보였지만. 그래도...)
- 그리고 선택과 집중에 대해서 다시 되짚어 보면서 갈등이 되었다.
- 프론트도 잘 못하는데(webpack? 그거 만질 일이 없는것 같았는데, 테스트는 아예 해본 적도 없고, lamda? 이거 이미지 관련된건가? next 에서 알아서 최적화 해주던데? broswer-cross? 이거 css 프레임워크에서 알아서 해주는 건데 신경써야 하나? ㅋㅋ, 반응형? 하 이거 진짜 엄청 지루한데...그래도 해야지 ㅋㅋ) 대충 이런 수준인데
- 하나도 못하는데 둘을 하려고 하니 집중도 못하고 효율도 떨어진다는 생각이 들었다.
- 어느정도 자신감이 생겼을때 그때 백엔드를 진득하게 붙어서 해보는건 어떤가? 라는 생각이 들면서
- 프론트로 뭐 해보려고 하면 어처피 백엔드가 있어야 되는데 하.. next 로 둘다 해버리면 참 편 했던 것 같았는데.. 속도가 느리니...
- vercel 에 돈 내고 진득하게 next 를 파는 것이 좋을 것 같다는 생각을 하면서도 서버를 만들어서 rds ec2 로 하자! 라는 생각도 들고
- 솔직히 어떻게 해야 할지 잘 몰라서 이리저리 헤매다가 하루를 다 보 냈다.

## 어려운점

- 그렇다면 백엔드 서버를 구축 했을때와 next 로 만 했을때 비교를 좀 해보면 어떨까?

- nextjs

  - 백엔드 로직 한방에 끝낼 수 있으며
  - 라우팅 이 편하고, 이미지 최적화, 배포(vercel)등이 매우 편하다
  - ssg 가 있을 경우 성능에서 이점이 있고
  - 혹시 seo 에 신경 써야 할 페이지가 있는 경우 더욱 좋다
  - 아직 작성은 안해봤지만 test코드 작성할때도 이것 저것 편한점이 있는 것 같았다. 아무래도 프레임 워크니까.

  - 하지만 다 만들고 허탈 할 것 같다 배포 하면 느리니까...
  - 2000~3000 반응 시간이 걸리는데 그냥 망한거다...
  - 돈을 내려면 플랜을 읽고 db에 가장 가까운 장소를 골라야 되는데
  - 솔직히 별로 내키지 않는데 왜냐하면 db도 rds 사용중이라 언제 어떻게 될줄 모르는 상황.
  - 또 솔직히 express 보다 더 사용하기 불편한 점도 있었다(매서드를 같이 섞어서쓰다보니 엄청 복잡하고 길어진 코드 ㅠ)

- 백엔드 별도 구성

  - 일단 코드가 비교적 더 깔끔해 질 것이다.(오류처리 methed 별 처리 등등)
  - 그리고 배포시 db와 백 프 섭이 같은 리전에 있게 될 것이므로 속도도 빨라질 것이다.
  - 솔직히 백엔드 재미 있다~~ 아마 백엔드에 더 치중해서 프로젝트를 할 것 같다.
  - 그러면 안좋다... 프론트로 일을 하고 싶기 때문이다.
  - 어느하나에 집중 할 수가 없다.
  - 하지만 어느정도 숙달이 되면 오히려 좀더 나을 수도 있다. 그게 언제가 될 지 모르지만 ㅋㅋ

  ## 해야 할 일

  - 아직 모르겠다.
  - 내일까지는 어느 하나 선택해서 그걸로 밀어붙이자.
  - 한다면 좀더 스마트 하게!~ 하자.
